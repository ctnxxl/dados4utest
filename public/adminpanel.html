<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Admin Panel | Dados4U</title>
  <link rel="icon" type="image/png" href="./imgs/favico.ico" />
  <script>document.write('<link rel="stylesheet" href="./css/adminpanel.css?v='+new Date().getHours()+'">')</script>

  <style>body { visibility: hidden; }</style>

  <script>
    const token = localStorage.getItem('token');
    if (!token) window.location.replace('/login');
  </script>

  <script>
    (() => {
      const token = localStorage.getItem('token');
      if (!token) {
        window.location.replace('/login');
        return;
      }

      fetch('/api/me', {
        headers: { 'Authorization': 'Bearer ' + token }
      })
      .then(res => {
        if (!res.ok) throw new Error();
        return res.json();
      })
      .then(user => {
        if (user.role !== 'admin' && user.role !== 'superadmin') {
          window.location.replace('/');
          return;
        }
        document.body.style.visibility = 'visible';
      })
      .catch(() => window.location.replace('/login'));
    })();
  </script>
</head>
<body>
  <div class="admin-container">
    <aside class="sidebar">
      <img src="./imgs/logo.png" alt="">
      <h3>Menu de Opções</h3>
      <ul>
        <li><button onclick="mostrarSecao('secao-usuario')">Criar Usuário</button></li>
        <li><button onclick="mostrarSecao('secao-historico')">Ver Histórico</button></li>
      </ul>
    </aside>

    <main class="main-content">
      <div class="header-bar">
        <h1>Admin Panel</h1>
        <button class="btn" id="voltarBtn">Voltar</button>
      </div>

      <div id="secao-usuario" class="secao">
        <div id="create-user">
          <h2>Criar novo usuário</h2>
          <form id="form-create-user">
            <label>Usuário: <input name="username" required /></label><br />
            <label>Email: <input name="email" required type="email" /></label><br />
            <label>Senha:
              <input name="password" required type="password" minlength="6" placeholder="min. 6 caracteres" />
            </label><br />
            <label>Role:
              <select name="role" id="roleSelect">
                <option value="user">User</option>
                <option value="admin">Admin</option>
                <option value="superadmin">Superadmin</option>
              </select>
            </label><br />
            <button type="submit">Criar</button>
          </form>
          <hr />
        </div>
      </div>

      <div id="secao-historico" class="secao" style="display: none;">
        <div id="search-history">
          <h2>Histórico de buscas</h2>
          <table id="history-table">
            <thead>
              <tr>
                <th>ID</th>
                <th>Usuário</th>
                <th>Termo pesquisado</th>
                <th>Data</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </main>
  </div>

  <script>
    function mostrarSecao(id) {
      document.querySelectorAll('.secao').forEach(secao => secao.style.display = 'none');
      document.getElementById(id).style.display = 'block';
    }
  </script>
  <script>document.write('<script src="./script/adminpanel.js?v='+new Date().getHours()+'"><\/script>')</script>

</body>
</html>
